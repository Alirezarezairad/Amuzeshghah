# 🧩 درس ۸ — کدهای ما کجا اجرا می‌شوند؟ اهمیت محل قرارگیری تگ `<script>`

---

## 🎯 هدف درس

هدف این است که بدانید **محل دقیق قرارگیری تگ `<script>`** در فایل HTML چقدر می‌تواند بر سرعت بارگذاری و نحوهٔ کارکرد کدهای جاوا اسکریپت ما تأثیر بگذارد، و یاد بگیرید که بهترین محل برای قرار دادن این تگ کجاست.

---

## 🧠 توضیح مفهومی ساده و روان

بیایید صفحهٔ وب را به یک **رستوران** تشبیه کنیم و مرورگر شما (Chrome، Firefox یا هر چیز دیگری) سرآشپز این رستوران باشد.

1. **سرآشپز (مرورگر) شروع به کار می‌کند:** سرآشپز شروع به خواندن منو (فایل HTML) از بالا به پایین می‌کند. هر چیزی که می‌خواند (مثل میزها، صندلی‌ها، دکوراسیون که همان عناصر HTML هستند)، فوراً می‌سازد و می‌چیند.
2. **برخورد با دستورالعمل (تگ `<script>`):** ناگهان سرآشپز به یک تگ `<script>` (دستورالعمل جاوا اسکریپت) برمی‌خورد. او باید فوراً کار چیدن میز و صندلی‌ها را متوقف کند.
3. **توقف و اجرا (Stop and Go):** سرآشپز نمی‌تواند هم‌زمان هم میز بچیند و هم دستورالعمل پیچیدهٔ جاوا اسکریپت را بخواند و اجرا کند. پس مجبور است **مکث کند**، کد جاوا اسکریپت را خط به خط اجرا کند و مطمئن شود کارش درست است.
4. **مشکل بزرگ:** اگر دستورالعمل (جاوا اسکریپت) بگوید: "لطفاً دکمه‌ای به نام 'دکمهٔ قرمز' را بردار و رنگ آن را آبی کن"، اما سرآشپز هنوز به پایین منو نرسیده باشد و آن دکمه را نساخته باشد، چه اتفاقی می‌افتد؟ **کد شما خطا می‌دهد!** چون دکمه‌ای که باید پیدا می‌شد، هنوز وجود خارجی ندارد.

پس نتیجه می‌گیریم: اگر کدهای جاوا اسکریپت شما می‌خواهند عناصر HTML را دستکاری کنند (که معمولاً همین‌طور است)، باید مطمئن شویم که **عناصر ابتدا ساخته شده‌اند** و سپس کد ما اجرا شود.

---

## ⚙️ مراحل یادگیری گام‌به‌گام

1. **محل سنتی (بدترین مکان):** قرار دادن تگ `<script>` در قسمت `<head>` از نظر سنتی درست است. اما همانطور که در مثال رستوران دیدیم، این باعث می‌شود مرورگر (سرآشپز) همان ابتدا کارش را متوقف کند، کدهای جاوا اسکریپت را دانلود و اجرا کند و سپس به ساختن بدنهٔ صفحه بپردازد. این کار **صفحهٔ شما را کُند می‌کند**.
2. **محل استاندارد و بهتر:** بهترین مکان برای قرار دادن تگ `<script>` (اگر از صفت `defer` استفاده نکنیم) **درست قبل از بسته شدن تگ `</body>`** است.
3. **چرا انتهای `<body>`؟** چون در این حالت، مرورگر تمام عناصر HTML صفحه (مانند تیترها، پاراگراف‌ها و دکمه‌ها) را ساخته و چیده است و وقتی به تگ `<script>` می‌رسد، همه چیز برای دستکاری آماده است.
4. **تکنیک جادویی (بازبینی درس ۷):** در درس قبل یاد گرفتیم که استفاده از صفت **`defer`** در تگ `<script>` (حتی اگر در `<head>` باشد) به مرورگر می‌گوید که فایل جاوا اسکریپت را دانلود کند، اما **اجرای آن را به بعد از کامل شدن پردازش HTML موکول کند**. این روش نیز بسیار عالی است و سرعت بارگذاری را بهبود می‌بخشد.
5. **اجرای مستقیم در تگ:** اگر شما کد جاوا اسکریپت را مستقیماً در تگ‌های HTML (مثلاً با استفاده از صفت `onclick`) می‌نویسید، نیازی به نگرانی بابت زمان‌بندی کلی اجرای کد نیست، زیرا این کدها فقط هنگام تعامل کاربر (مثل کلیک کردن) اجرا می‌شوند.

---

## 💡 نکات طلایی معلم

* **زمان‌بندی همه‌چیز است:** در برنامه‌نویسی وب، **زمان** بارگذاری کدها بسیار مهم است. اگر کد شما زودتر از عناصر HTML اجرا شود و سعی کند آن‌ها را پیدا کند، با شکست مواجه می‌شود (مانند تلاش برای یافتن دکمه‌ای که هنوز ساخته نشده است).
* **عادت خوب:** همیشه سعی کنید کدهای جاوا اسکریپت خارجی را در **انتهای تگ `<body>`** یا با استفاده از صفت **`defer`** در تگ `<head>` قرار دهید. این بهترین شیوهٔ برنامه‌نویسی (Best Practice) است.
* **نتیجهٔ نهایی:** اگر مرورگر هنگام پردازش HTML به تگ `<script>` بدون صفت `defer` یا `async` برسد، **عملیات پردازش صفحه را کاملاً متوقف می‌کند** تا کد جاوا اسکریپت کامل اجرا شود. این توقف، چیزی است که ما از آن فرار می‌کنیم!

---

## 📋 نمونه کد یا مثال واقعی

بیایید ببینیم اگر جاوا اسکریپت را در جای اشتباه بگذاریم، چه می‌شود.

**فایل `bad_timing.html` (مثال بد):**

```html
<!DOCTYPE html>
<html>
<head>
    <title>زمان‌بندی بد</title>
    <!-- ❌ جاوا اسکریپت در Head قرار دارد -->
    <script>
        // سعی می‌کنیم به دکمه دسترسی پیدا کنیم
        const button = document.getElementById('myButton'); 
        
        // اینجا کد خطا می‌دهد، چون مرورگر هنوز به تگ <body> نرسیده تا دکمه را بسازد!
        if (button === null) { 
            alert("اخطار! دکمه هنوز ساخته نشده است.");
        }
    </script>
</head>
<body>
    <h1>صفحه من</h1>
    <button id="myButton">دکمهٔ قرمز</button> 
    <!-- دکمه اینجا تعریف شده، اما کد بالا زودتر اجرا می‌شود. -->
</body>
</html>
```

**فایل `good_timing.html` (مثال خوب):**

```html
<!DOCTYPE html>
<html>
<head>
    <title>زمان‌بندی خوب</title>
</head>
<body>
    <h1>صفحه من</h1>
    <button id="myButton">دکمهٔ آبی</button>

    <!-- ✅ جاوا اسکریپت در انتهای Body قرار دارد -->
    <script>
        // مرورگر تمام HTML را ساخته است، حالا کد اجرا می‌شود.
        const button = document.getElementById('myButton');
        button.style.backgroundColor = 'blue'; 
        alert("دکمه با موفقیت آبی شد!");
    </script>
</body>
</html>
```

---

## 🧪 تمرین درس

1. فایل `bad_timing.html` بالا را ذخیره کرده و در مرورگر باز کنید. ببینید که هشدار (Alert) اجرا می‌شود و اعلام می‌کند دکمه پیدا نشده است.
2. فایل `good_timing.html` بالا را ذخیره کرده و باز کنید. ببینید که دکمه واقعاً به رنگ آبی درمی‌آید و هشدار موفقیت‌آمیز را نمایش می‌دهد.
3. سعی کنید در فایل `good_timing.html`، تگ `<script>` را به قسمت `<head>` منتقل کنید و ببینید آیا کار می‌کند یا خیر (اگر کد خطا داد، علت آن همان مشکل زمان‌بندی است).

---

## 🧾 خلاصه (Cheat Sheet)

| مفهوم                     | محل قرارگیری                           | اهمیت/نحوهٔ اجرا                                                                      |
| :------------------------ | :------------------------------------- | :------------------------------------------------------------------------------------ |
| **JS در `<head>`**        | بالای تگ `<body>`                      | **باعث توقف پردازش HTML** می‌شود و صفحه کُند می‌شود.                                  |
| **JS در انتهای `<body>`** | درست قبل از `</body>`                  | **بهترین محل**؛ تضمین می‌کند که تمام عناصر HTML برای دسترسی آماده‌اند.                |
| **صفت `defer`**           | در تگ `<script>` (معمولاً در `<head>`) | دانلود را زودی انجام می‌دهد، اما **اجرا را تا پایان پردازش HTML به تعویق می‌اندازد**. |
| **اجرای کد**              | از بالا به پایین                       | مرورگر کار چیدن عناصر را متوقف کرده و JS را اجرا می‌کند.                              |

---

## 📚 آزمون کوچک پایانی

1. اگر تگ `<script>` را در قسمت `<head>` قرار دهیم، مرورگر برای اجرای آن چه کاری انجام می‌دهد؟
2. اگر کد جاوا اسکریپت سعی کند یک پاراگراف را تغییر دهد که هنوز توسط مرورگر پردازش نشده است، چه اتفاقی می‌افتد؟
3. بهترین مکان در ساختار HTML برای قرار دادن تگ `<script>` (در حالت عادی) کجاست؟
4. چرا قرار دادن تگ `<script>` در انتهای `<body>` یک "عادت خوب" است؟
5. کدام صفت در تگ `<script>` تضمین می‌کند که اجرای کد تا پایان پردازش HTML به تأخیر بیفتد؟
6. اگر مرورگر به تگ `<script>` برسد، آیا می‌تواند همزمان پردازش HTML و اجرای JS را انجام دهد؟
7. اگر از تگ `<script>` در `<head>` استفاده کنیم، کدام بخش از فرآیند بارگذاری صفحه با مشکل تأخیر روبرو می‌شود؟
8. اگر یک توسعه‌دهنده از جاوا اسکریپت برای دستکاری "مدل شیءگرای سند" (DOM) استفاده می‌کند، چه زمانی باید کد اجرا شود؟
9. "رستوران" در مثال مفهومی امروز، نماد چه چیزی بود؟
10. "سرآشپز" در مثال مفهومی امروز، نماد چه چیزی بود؟
11. آیا جاوا اسکریپت می‌تواند مستقیماً داخل یک تگ HTML نوشته شود (مثلاً برای یک رویداد خاص)؟
12. اگر فقط از `src` در تگ `<script>` استفاده کنیم و هیچ صفت دیگری ندهیم، آیا مرورگر برای دانلود فایل JS مکث می‌کند؟
13. صفت `async` بر دانلود فایل چه تأثیری دارد؟
14. صفت `defer` بر اجرای کد چه تأثیری دارد؟
15. منظور از DOM (که در درس‌های بعد می‌خوانیم) در این درس چیست؟

---

## ✅ پاسخنامهٔ آزمون

1. مرورگر پردازش و ساختن صفحهٔ HTML را متوقف کرده و ابتدا کد جاوا اسکریپت را دانلود و اجرا می‌کند.
2. کد خطا می‌دهد، زیرا نمی‌تواند آن عنصر (پاراگراف) را پیدا کند.
3. درست قبل از بسته شدن تگ `</body>`.
4. چون تضمین می‌کند که تمام عناصر HTML قبل از اجرای کد جاوا اسکریپت آمادهٔ دسترسی و دستکاری هستند.
5. `defer`.
6. خیر، مرورگر توقف می‌کند تا اجرای کد جاوا اسکریپت کامل شود.
7. نمایش محتوای صفحه (Render کردن).
8. پس از اطمینان از بارگذاری کامل عناصر HTML مورد نیاز.
9. صفحهٔ وب.
10. مرورگر.
11. بله، مثلاً با استفاده از صفت `onclick`.
12. بله، توقف کامل را خواهیم داشت.
13. دانلود فایل JS به صورت ناهمگام (Asynchronous) انجام می‌شود و پردازش HTML متوقف نمی‌شود.
14. اجرای کد را به بعد از تجزیه کامل HTML موکول می‌کند.
15. مدل شیءگرای سند (Document Object Model) که همان ساختار سلسله‌مراتبی عناصر HTML است که جاوا اسکریپت می‌تواند آن‌ها را تغییر دهد.

---

## 🌟 پیام انگیزشی پایانی

عالی بود! شما امروز یک درس مهم در مورد زمان‌بندی و سرعت صفحات وب را یاد گرفتید. این یعنی شما هوشمندانه کد می‌زنید!
**تو امروز یک قدم به تبدیل شدن به یک فول‌استک واقعی نزدیک‌تر شدی!**


