
### 🧩 درس ۱۷ — رشته‌ها و توالی‌های فرار (Escape Sequences) (صفحهٔ ۱۰۰ تا ۱۰۵)

این درس روی تعریف و کاربرد رشته‌ها، نحوهٔ استفاده از انواع مختلف نقل قول‌ها، و چگونگی جاسازی مقادیر و عبارات در رشته‌ها تمرکز دارد.

### 🎯 هدف درس

هدف اصلی این درس این است که شما:

1. درک کنید که رشته (String) چیست و چگونه در جاوااسکریپت تعریف می‌شود.

2. نحوهٔ استفاده صحیح از نقل‌قول‌های تکی، دوتایی و بک‌تیک را بیاموزید.

3. قادر به استفاده از قالب‌های رشته‌ای (Template Strings) و جاسازی مقادیر (Interpolation) باشید.

4. بتوانید طول یک رشته را محاسبه کنید.

5. مفهوم توالی‌های فرار (Escape Sequences) را برای درج کاراکترهای خاص درک کنید.

---

### 🧠 توضیح مفهومی ساده و روان با مثال‌های واقعی

تصور کنید که شما در حال **نوشتن یک کتاب یا رمان** هستید.

**رشته‌ها**
، متن اصلی کتاب شما هستند. جاوااسکریپت باید بداند که متن شما از کجا شروع و در کجا تمام می‌شود.

* **نقل‌قول‌های تکی/دوتایی:**
 مثل جلد کتاب شما هستند. شما باید انتخاب کنید که کتابتان جلد تکی داشته باشد یا دوتایی. مهم این است که اگر با جلد تکی شروع کردید، با جلد تکی هم تمام کنید.

  * مشکل زمانی پیش می‌آید که شما می‌خواهید نقل‌قولی از یک شخصیت (مثلاً `"او گفت: 'عالیه!' "`) را داخل متنتان بیاورید. اگر از جلد دوتایی استفاده کرده‌اید، برای نقل‌قول داخلی باید از جلد تکی استفاده کنید یا برعکس.

* **توالی‌های فرار (Escape Sequences):**
 این‌ها کدهای مخفی‌ای هستند که به مترجم جاوااسکریپت می‌گویند: "اینجا یک کاراکتر خاص است." مثلاً، اگر می‌خواهید در انتهای یک پاراگراف بروید به سطر بعدی، از توالی فرار `\n` (سطر جدید) استفاده می‌کنید.

* **قالب‌های رشته‌ای (Template Strings):**
 این‌ها مثل یک فرمول جادویی هستند. به جای اینکه هر بار اسم شخصیت را تایپ کنید، یک جای خالی (مثلاً `${نام}`) می‌گذارید و جاوااسکریپت به صورت خودکار، در زمان نمایش، آن جای خالی را با مقدار واقعی پر می‌کند.

---

### ⚙️ آموزش گام‌به‌گام با همه مفاهیم و زیر‌بخش‌ها

#### ۱. تعریف رشته‌ها (Strings)

رشته‌ها، دنباله‌ای از کاراکترها (حروف، اعداد، نمادها) هستند. برای تعریف یک رشته در جاوااسکریپت می‌توانید از نقل‌قول‌های تکی (`' '`) یا دوتایی (`" "`) استفاده کنید.

**💻 لیست ۳.۱۹: مثال‌هایی برای تعریف رشته‌ها**

```javascript
const firstName = 'Max';     // نقل‌قول‌های تکی
const lastName = "Mustermann"; // نقل‌قول‌های دوتایی
const age = "22";            // یک عدد، اما داخل نقل‌قول، پس رشته است
const street = 'Musterstraße'; // تعریف صحیح
// const invalidStreet = 'Musterstraße"; // Syntaxfehler: Mischform
```

**💬 نکته طلایی استاد:** دقت کنید که اگرچه `age` شامل ارقام است، اما چون در نقل‌قول قرار دارد، جاوااسکریپت آن را به عنوان یک رشته (String) در نظر می‌گیرد، نه یک عدد (Number). این تفاوت در هنگام عملیات ریاضی (مانند جمع) بسیار مهم است.

#### ۲. توالی‌های فرار (Escape Sequences)

اگر بخواهید کاراکتر خاصی را در رشته وارد کنید که در حالت عادی ممنوع است (مانند همان نقل‌قولی که رشته را تعریف کرده) یا یک کاراکتر کنترلی (مانند رفتن به سطر جدید)، باید از توالی‌های فرار استفاده کنید. توالی فرار با یک بک‌اسلش (`\`) آغاز می‌شود.

**💻 مثال ۱: استفاده از توالی‌های فرار**

```javascript
// اگر از نقل‌قول دوتایی استفاده کرده‌اید، برای درج نقل‌قول دوتایی از بک‌اسلش استفاده کنید.
const message1 = "او گفت: \"سلام، دنیا!\"";
console.log(message1); // خروجی: او گفت: "سلام، دنیا!"

// رفتن به سطر جدید (Line Feed)
const multiline = "خط اول.\nخط دوم.";
console.log(multiline); 
// خروجی:
// خط اول.
// خط دوم.
```

#### ۳. قالب‌های رشته‌ای (Template Strings یا Template Literals)

قالب‌های رشته‌ای که از استاندارد ES2015 معرفی شدند، روشی مدرن و بسیار قوی برای تعریف رشته‌ها هستند که با کاراکتر **بک‌تیک** (`` ` ``) تعریف می‌شوند.

مزیت اصلی آن‌ها این است که نیاز به استفاده از عملگر `+` برای الحاق رشته و متغیرها را حذف می‌کنند و امکان **جاسازی عبارت (Expression Interpolation)** را فراهم می‌آورند.

**💻 لیست ۳.۲۵: کاربرد جاسازی عبارت**

در این مثال، مقادیر متغیرها مستقیماً درون رشته جاسازی می‌شوند:

```javascript
const name = 'Max Mustermann';
const age = 44;
// استفاده از بک‌تیک و سازوکار ${...}
const message = `Mein Name ist ${name}, ich bin ${age} Jahre alt.`;

console.log(message);
// خروجی: Mein Name ist Max Mustermann, ich bin 44 Jahre alt.
```

#### ۴. ارزیابی عبارات درون رشته‌ها (Evaluating Expressions)

قابلیت جاسازی عبارت (Interpolation) به سادگی به متغیرها محدود نمی‌شود؛ شما می‌توانید هر **عبارت معتبری** را درون `${...}` قرار دهید. این شامل فراخوانی توابع، انجام عملیات ریاضی، و حتی عبارات شرطی است.

**💻 لیست ۳.۲۶: ارزیابی توابع و عملیات ریاضی**

```javascript
const name = 'Max Mustermann';
const age = 44;

function getName() {
    return name;
}

// جاسازی یک فراخوانی تابع و یک عبارت ریاضی
const message = `Mein Name ist ${getName()}, ich bin das Doppelte von ${age/2} Jahren alt`;

console.log(message);
// خروجی: Mein Name ist Max Mustermann, ich bin das Doppelte von 22 Jahren alt
```

#### ۵. محاسبهٔ طول رشته (String Length)

برای پیدا کردن تعداد کاراکترهای یک رشته (شامل حروف، فضاها و نمادها)، از خاصیت `length` استفاده می‌شود. این ویژگی در اعتبارسنجی ورودی‌ها (مثلاً حداقل یا حداکثر طول نام کاربری) بسیار حیاتی است.

**💻 لیست ۴.۹۶ (بخشی از مثال): استفاده از ویژگی length**

```javascript
function checkUsername(userName) {
    if(userName.length < 5) { // بررسی طول رشته
        console.error('Nutzername muss mindestens 5 Zeichen enthalten.');
    } else if(userName.length > 8) {
        console.error('Nutzername darf maximal 8 Zeichen enthalten.');
    } else {
        console.log('Gültiger Nutzername');
    }
}

checkUsername('Max');          // طول 3. خطا، چون کوتاه است
checkUsername('Max Mustermann'); // طول 14. خطا، چون بلند است
checkUsername('MaxMuste');     // طول 8. معتبر است
```

---

### 💻 بازسازی کدها و مثال‌های کتاب

تمام مثال‌های اصلی مربوط به تعریف رشته و قالب‌های رشته‌ای در بخش‌های بالا بازسازی و تشریح شدند. در اینجا یک مثال جامع‌تر از تداخل نقل‌قول‌ها آورده شده است.

**💻 مثال ۲: تداخل نقل‌قول‌ها و استفاده از توالی فرار**

```javascript
// مثال ۱: استفاده از نقل‌قول دوتایی در رشته‌ای که با نقل‌قول تکی تعریف شده است.
const quote1 = 'او گفت: "این یک نقل‌قول است."'; 
console.log(quote1); // خروجی: او گفت: "این یک نقل‌قول است."

// مثال ۲: استفاده از توالی فرار برای درج نقل‌قول تکی درون رشته‌ای با نقل‌قول تکی.
const quote2 = 'آن کلمه \'تأکید\' شده بود.'; 
console.log(quote2); // خروجی: آن کلمه 'تأکید' شده بود.

// مثال ۳: اگر از بک‌تیک استفاده کنید، نیازی به فرار برای نقل‌قول‌ها نیست.
const templateQuote = `او گفت: "عالیه!" و سپس 'لبخند' زد.`;
console.log(templateQuote); 
```

---

### 📊 نمودارها و جداول (بازسازی شده در قالب Markdown)

#### جدول ۱: روش‌های تعریف رشته (String Definition)

|           نوع نقل‌قول           | کاراکتر |                       مزایا                       |          موارد استفاده          |
| :-----------------------------: | :-----: | :-----------------------------------------------: | :-----------------------------: |
|               تکی               |  `' '`  |                  سنتی، ساده، رایج                 | رشته‌های ایستا (Static Strings) |
|              دوتایی             |  `" "`  |                  سنتی، ساده، رایج                 | رشته‌های ایستا (Static Strings) |
| قالب رشته‌ای (Template Literal) | `` ` `` | پشتیبانی از جاسازی عبارت (`${}`)، رشته‌های چندخطی |  رشته‌های پویا، قالب‌بندی خروجی |

#### جدول ۲: توالی‌های فرار رایج (Common Escape Sequences)

| توالی فرار |      مفهوم     |                  توضیحات                  |
| :--------: | :------------: | :---------------------------------------: |
|    `\'`    |   نقل‌قول تکی  |   برای درج `'` در یک رشته با نقل‌قول تکی  |
|    `\"`    | نقل‌قول دوتایی | برای درج `"` در یک رشته با نقل‌قول دوتایی |
|    `\\`    |     بک‌اسلش    |          برای درج کاراکتر بک‌اسلش         |
|    `\n`    |    سطر جدید    |              شروع یک خط جدید              |
|    `\t`    |       تب       |           درج فاصلهٔ افقی (Tab)           |

#### جدول ۳: ارزیابی عبارت در قالب رشته‌ای (Interpolation)

| عبارت جاسازی شده |      مثال      |          خروجی معادل         | منبع |
| :--------------: | :------------: | :--------------------------: | :--: |
|       متغیر      |    `${name}`   |      مقدار متغیر `name`      |      |
|    عبارت ریاضی   |  `${age / 2}`  |    نتیجهٔ تقسیم `age` بر ۲   |      |
|   فراخوانی تابع  | `${getName()}` | مقدار بازگشتی تابع `getName` |      |

#### جدول ۴: مقایسهٔ نوع دادهٔ عددی و رشته‌ای

|  مقدار | نوع داده |      رفتار در عملیات `+`     |   منبع   |
| :----: | :------: | :--------------------------: | :------: |
|  `22`  |  Number  |           جمع ریاضی          | (درس ۱۶) |
| `"22"` |  String  | الحاق (String Concatenation) |          |

---

### 💬 نکات طلایی استاد و اشتباهات رایج

1. **رشته، همیشه رشته است:**
 رایج‌ترین اشتباه برنامه‌نویسان تازه‌کار، فراموش کردن این نکته است که محتوای داخل نقل‌قول، حتی اگر عدد باشد (`"4711"`), به عنوان رشته شناخته می‌شود. این کار باعث می‌شود به جای جمع (`1 + "1" = "11"`), الحاق انجام شود. همیشه برای محاسبات، مطمئن شوید که متغیرتان از نوع `number` است.

2. **استفاده از بک‌تیک‌ها:**
 قالب‌های رشته‌ای (Template Literals) فقط زمانی کار می‌کنند که از کاراکتر بک‌تیک (`` ` ``) استفاده کنید، نه نقل‌قول‌های معمولی. اگر از نقل‌قول معمولی استفاده کنید، عبارت `${...}` ارزیابی نخواهد شد و به صورت یک متن عادی دیده می‌شود.

3. **چندخطی بودن ساده:**
 اگر می‌خواهید یک رشتهٔ چندخطی تعریف کنید، استفاده از بک‌تیک ساده‌ترین راه است. در غیر این صورت، مجبورید از توالی فرار `\n` در انتهای هر خط استفاده کنید.

---

### 🧪 تمرین‌ها

#### تمرین ۱: تشخیص نوع داده (اجباری)

خروجی کد زیر چیست؟

```javascript
const x = 5;
const y = "10";
const result = x + y;
console.log(result);
console.log(typeof result);
```

#### تمرین ۲: استفاده از قالب رشته‌ای (اجباری)

تابعی بنویسید که نام و نام خانوادگی را به عنوان ورودی بگیرد و خروجی زیر را با استفاده از قالب رشته‌ای تولید کند:

**خروجی مورد انتظار:**
 `خوش آمدید، [نام] [نام خانوادگی]! تعداد حروف نام شما [تعداد حروف] است.`

#### تمرین ۳: توالی فرار (اجباری)

چگونه می‌توانید رشتهٔ زیر را به درستی تعریف کنید، به طوری که تماماً درون یک جفت نقل‌قول دوتایی قرار گیرد؟

```
"او گفت: "این قانون است.""
```

#### تمرین ۴: ارزیابی عبارت (اجباری)

متغیر `price` را برابر با `100` و `taxRate` را برابر با `0.05` قرار دهید. سپس یک قالب رشته‌ای بنویسید که قیمت نهایی (شامل مالیات) را محاسبه و نمایش دهد.

#### تمرین ۵: تعیین طول (تکمیلی)

مقدار `console.log("Hello\nWorld".length)` چقدر است؟ (کاراکتر سطر جدید را در نظر بگیرید.)

#### تمرین ۶: ترکیب نقل‌قول‌ها (تکمیلی)

تلاش برای اجرای کد زیر چه نتیجه‌ای می‌دهد؟ چرا؟

```javascript
const statement = 'It\'s raining outside.';
console.log(statement);
```

#### تمرین ۷: قالب چندخطی (تکمیلی)

کد زیر چه خروجی‌ای می‌دهد؟ (این مورد مربوط به قابلیت چندخطی بودن Template Literal است.)

```javascript
const poem = `
  ستاره‌ای بدرخشید
  و ماه مجلس شد
`;
console.log(poem);
```

#### تمرین ۸: تمرین شرطی در جاسازی (تکمیلی)

فرض کنید `const isAdult = true;` است. با استفاده از یک عبارت شرطی سه‌تایی (Ternary Operator) درون یک قالب رشته‌ای، خروجی زیر را تولید کنید:

**خروجی مورد انتظار:**
 `وضعیت: مجاز به ورود.` (اگر `isAdult` true است) یا `وضعیت: محدودیت سنی.` (اگر `isAdult` false است).

---

### 💡 یک پروژه یا مثال کاربردی: ساخت کارت امتیازی پویا

می‌خواهیم با استفاده از قالب‌های رشته‌ای و ارزیابی عبارات، یک کارت امتیازی ساده برای یک بازی بسازیم.

**سناریو:** 
یک بازیکن بازی کرده و نتیجهٔ او باید نمایش داده شود. ما نیاز داریم زمان بازی را به دقیقه تبدیل کنیم و درصد موفقیت او را محاسبه کنیم.

```javascript
// داده‌های بازیکن
const playerName = "آرمین";
const score = 85;
const maxScore = 100;
const timeSeconds = 345; // زمان به ثانیه

// تابع کمکی برای تبدیل زمان
function formatTime(seconds) {
    const minutes = Math.floor(seconds / 60);
    const remainingSeconds = seconds % 60;
    return `${minutes} دقیقه و ${remainingSeconds} ثانیه`;
}

// تولید کارت امتیازی با قالب رشته‌ای
const scoreCard = `
=========================================
      کارت امتیازی بازیکن: ${playerName}
=========================================
امتیاز کسب شده: ${score} از ${maxScore}
درصد موفقیت: ${(score / maxScore * 100).toFixed(2)}%  // ارزیابی ریاضی
زمان بازی: ${formatTime(timeSeconds)}        // فراخوانی تابع
تاریخ گزارش: ${new Date().toLocaleDateString('fa-IR')} // فراخوانی شیء سراسری
=========================================
`;

console.log(scoreCard);
// خروجی (با تاریخ جاری):
// =========================================
//       کارت امتیازی بازیکن: آرمین
// =========================================
// امتیاز کسب شده: 85 از 100
// درصد موفقیت: 85.00%
// زمان بازی: 5 دقیقه و 45 ثانیه
// تاریخ گزارش: ۱۴۰۲/۸/۲۰ 
// =========================================
```

---

### 🧾 خلاصه (Cheat Sheet)

| مفهوم        | ساختار                          | توضیح                              | منبع |
| :----------- | :------------------------------ | :--------------------------------- | :--: |
| تعریف رشته   | `'text'` یا `"text"`            | استفاده از نقل‌قول تکی یا دوتایی.  |      |
| جاسازی عبارت | `` `text ${expression} text` `` | استفاده از بک‌تیک و سازوکار `${}`. |      |
| طول رشته     | `string.length`                 | محاسبهٔ تعداد کاراکترهای رشته.     |      |
| الحاق رشته   | `str1 + str2`                   | چسباندن رشته‌ها (نه جمع ریاضی).    |      |
| توالی فرار   | `\n`, `\"`, `\\`                | نمایش کاراکترهای خاص.              |      |

---

### 📚 آزمون پایانی (۱۰ سؤال)

**۱. تعریف رشته:** کدام یک از تعاریف زیر در جاوااسکریپت، یک خطای نحوی (Syntax Error) ایجاد می‌کند؟

الف) `const x = 'Hello World';`

ب) `const y = "Hello World";`

ج) `const z = `Hello World`;`

د) `const w = 'Hello World";`

**۲. نوع داده:** مقدار متغیر `val` در کد زیر چیست؟
`const val = typeof (4 + "4")`

الف) `"number"`

ب) `"string"`

ج) `8`

د) `"44"`

**۳. قالب رشته‌ای:** برای جاسازی یک متغیر به نام `user` درون یک قالب رشته‌ای، از کدام نحو (Syntax) استفاده می‌شود؟

الف) `{{user}}`

ب) `${user}`

ج) `$[user]`

د) `<user>`

**۴. ارزیابی عبارت:** در قالب‌های رشته‌ای، درون سازوکار `${}` چه نوع کدی می‌تواند ارزیابی شود؟

الف) فقط متغیرها

ب) فقط فراخوانی توابع

ج) فقط عملیات ریاضی

د) همهٔ موارد بالا

**۵. طول رشته:** خروجی `console.log("JavaScript".length)` چقدر است؟

الف) ۹

ب) ۱۰

ج) ۱۱

د) ۸

**۶. توالی فرار:** کدام توالی فرار برای ایجاد یک سطر جدید (Line Break) درون یک رشته استفاده می‌شود؟

الف) `\t`

ب) `\r`

ج) `\n`

د) `\l`

**۷. خروجی کد:** خروجی `console.log("صفحه‌ی اول.\nصفحه‌ی دوم.")` در کنسول چگونه نمایش داده می‌شود؟

الف) صفحه‌ی اول.صفحه‌ی دوم.

ب) صفحه‌ی اول.\nصفحه‌ی دوم.

ج) در دو خط جداگانه

د) خطا می‌دهد

**۸. استفاده از نقل‌قول:** اگر بخواهید درون یک رشته که با نقل‌قول دوتایی (`"`) تعریف شده، یک نقل‌قول دوتایی دیگر را درج کنید، چه کاراکتری باید قبل از نقل‌قول داخلی قرار دهید؟

الف) `_`

ب) `\`

ج) `/`

د) از نقل‌قول تکی استفاده کنید

**۹. Template Literal:** کدام یک از مزایای اصلی Template Literal در مقایسه با الحاق رشتهٔ سنتی (با استفاده از `+`) نیست؟

الف) اجازهٔ نوشتن رشته‌های چندخطی بدون نیاز به `\n`.

ب) خوانایی بیشتر هنگام استفاده از متغیرها (Interpolation).

ج) جلوگیری از خطاهای نوع داده (Type Errors).

د) امکان ارزیابی عبارات (Expressions) درون رشته.

**۱۰. تشخیص نوع داده:** اگر `const val = "4711";` تعریف شود، `val` چه نوع داده‌ای دارد؟

الف) Number

ب) Boolean

ج) String

د) Object

---

#### 🌟 پاسخنامهٔ تشریحی

**۱. پاسخ: د) `const w = 'Hello World";`**

دلیل: استفاده از نقل‌قول تکی در ابتدا و نقل‌قول دوتایی در انتها، که نقض قانون عدم ترکیب انواع نقل‌قول است.

**۲. پاسخ: ب) `"string"`**

دلیل: هنگامی که یک عدد (`4`) با یک رشته (`"4"`) با استفاده از عملگر `+` ترکیب می‌شود، جاوااسکریپت عدد را به رشته تبدیل کرده و عملیات الحاق (Concatenation) انجام می‌دهد، که نتیجهٔ آن رشتهٔ `"44"` خواهد بود. سپس `typeof` نوع آن را `"string"` برمی‌گرداند.

**۳. پاسخ: ب) `${user}`**

دلیل: این نحو استاندارد برای جاسازی متغیرها و عبارات در قالب‌های رشته‌ای (Template Literals) است.

**۴. پاسخ: د) همهٔ موارد بالا**

دلیل: درون سازوکار `${}` می‌توان هر عبارت معتبری شامل متغیرها، فراخوانی توابع، یا عملیات ریاضی را قرار داد.

**۵. پاسخ: ب) ۱۰**

دلیل: رشتهٔ "JavaScript" شامل ۱۰ کاراکتر است، و خاصیت `length` تعداد کاراکترها را برمی‌گرداند.

**۶. پاسخ: ج) `\n`**

دلیل: `\n` توالی فرار استاندارد برای درج کاراکتر Line Feed یا سطر جدید است.

**۷. پاسخ: ج) در دو خط جداگانه**

دلیل: توالی فرار `\n` باعث می‌شود متن بعد از آن در خط جدیدی نمایش داده شود.

**۸. پاسخ: ب) `\`**

دلیل: برای درج نقل‌قول دوتایی درون یک رشتهٔ تعریف شده با نقل‌قول دوتایی، باید از کاراکتر فرار بک‌اسلش (`\"`) استفاده شود.

**۹. پاسخ: ج) جلوگیری از خطاهای نوع داده (Type Errors).**

دلیل: Template Literals راحتی و خوانایی را افزایش می‌دهند، اما ذاتاً مکانیسم جدیدی برای جلوگیری از خطاهای نوع داده (مثلاً تلاش برای جمع زدن عدد و رشته به جای الحاق) ارائه نمی‌دهند.

**۱۰. پاسخ: ج) String**

دلیل: هر مقداری که داخل نقل‌قول قرار گیرد، حتی اگر عدد باشد، توسط جاوااسکریپت به عنوان نوع دادهٔ رشته (String) شناخته می‌شود.
