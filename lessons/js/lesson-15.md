
---

### 🧩 درس ۱۵ — ثابت‌ها (Constant) با `const`: مقادیر تغییرناپذیر

(پوشش از صفحهٔ ۹۶ تا ۹۶)

---

### 🎯 هدف درس:

هدف اصلی این درس یادگیری تعریف **ثابت‌ها (Constants)** در جاوااسکریپت با استفاده از کلمه کلیدی `const` است. شما خواهید آموخت که چگونه مقادیری را در برنامه تعریف کنید که پس از تعریف اولیه، هرگز قابل تغییر (بازنویسی) نباشند. این کار امنیت و پایداری کدهای شما را تضمین می‌کند.

---

### 🧠 توضیح مفهومی ساده و روان:

در نظر بگیرید که یک تیم فوتبال را مدیریت می‌کنید.

1. **متغیر (`let`):** می‌تواند شبیه به **امتیاز فعلی بازی** باشد؛ این مقدار دائماً با گل زدن تغییر می‌کند.

2. **ثابت (`const`):** می‌تواند شبیه به **تعداد بازیکنان مجاز در زمین** (۱۱ نفر) یا **قانون مسافت مجاز برای پنالتی** باشد. این قوانین *پایه‌ای* هستند و تحت هیچ شرایطی در طول بازی نباید عوض شوند. اگر کسی سعی کند قانون پنالتی را عوض کند، سوت داور به صدا در می‌آید و خطا اعلام می‌شود!

در جاوااسکریپت، `const` دقیقاً همین کار را می‌کند. به محض اینکه یک مقدار را با `const` تعریف کنید، جاوااسکریپت آن را قفل می‌کند و اگر سعی کنید آن را تغییر دهید، برنامه با یک خطا متوقف خواهد شد.

---

### ⚙️ آموزش گام‌به‌گام با همه مفاهیم و زیر‌بخش‌ها:

#### ۱. تعریف ثابت‌ها با `const`

کلمه کلیدی `const` (کوتاه‌شدهٔ Constant) از نسخه ES2015 معرفی شد و برای تعریف مقادیری به کار می‌رود که باید در طول عمر برنامه ثابت باقی بمانند.

💻 **نمونه کد ۱: تعریف ثابت ساده**

```javascript
const PI = 3.14159;
const MAX_USERS = 50; 
// ثابت‌ها معمولاً با حروف بزرگ و زیرخط (underscore) نوشته می‌شوند.
```

#### ۲. قانون طلایی: مقداردهی اولیه فوری

بزرگ‌ترین تفاوت سینتکسی بین `let` و `const` این است که **ثابت‌ها باید در همان لحظه اعلان، مقداردهی شوند** (Initialization). شما نمی‌توانید یک ثابت را اعلام کنید و بعداً به آن مقدار بدهید.

💻 **نمونه کد ۲: اعلان بدون مقداردهی (خطا)**

```javascript
const API_KEY; 
// خطا! SyntaxError: Missing initializer in const declaration 
// توضیحات: جاوااسکریپت مجبور است در همان لحظه بداند API_KEY چیست، 
// وگرنه اجازه تعریف به شما نمی‌دهد.
```

#### ۳. تغییرناپذیری (Immutability)

هنگامی که یک ثابت تعریف می‌شود، نمی‌توان آن را به یک مقدار دیگر **بازنویسی (Reassign)** کرد. اگر سعی کنید این کار را انجام دهید، جاوااسکریپت یک خطای زمان اجرا (Runtime Error) تولید می‌کند که معمولاً `TypeError` است.

💻 **نمونه کد ۳: تلاش برای بازنویسی (خطا)**

```javascript
const TAX_RATE = 0.15;
console.log(TAX_RATE); // خروجی: 0.15

// تلاش برای تغییر مقدار ثابت
TAX_RATE = 0.20; 

// >> خطا: TypeError: Assignment to constant variable. 
// توضیحات: برنامه در این نقطه متوقف می‌شود.
```

#### ۴. ثبات ارجاع در برابر ثبات محتوا (نکته پیشرفته)

این مهم‌ترین نکته برای درک کامل `const` است. وقتی شما یک **مقدار اولیه (Primitive Value)** (مثل عدد یا رشته) را با `const` تعریف می‌کنید، هم مقدار و هم ارجاع ثابت می‌ماند.

اما اگر یک **مقدار ارجاعی (Reference Value)** (مثل یک شیء یا آرایه) را با `const` تعریف کنید، تنها چیزی که ثابت می‌ماند، **ارجاع** به آن مکان در حافظه است. محتوای داخل آن مکان حافظه (یعنی خصوصیات شیء یا عناصر آرایه) *هنوز هم قابل تغییر هستند*.

به این می‌گویند **ثبات سطحی (Shallow Immutability)**.

💻 **نمونه کد ۴: تغییر محتوای شیء تعریف شده با `const`**

```javascript
const settings = { 
    theme: 'dark', 
    maxAttempts: 3 
};

// 1. مجاز: تغییر یک ویژگی داخلی شیء
settings.theme = 'light'; 

// 2. غیرمجاز: تلاش برای بازنویسی کل شیء
// settings = {}; 
// >> خطا: TypeError: Assignment to constant variable.

console.log(settings.theme); // خروجی: light 
// توضیحات: ویژگی theme تغییر کرده است، اما خود متغیر settings هنوز به همان شیء اولیه ارجاع می‌دهد.
```

---

### 💻 همه کدها و مثال‌های کتاب را بازسازی و خط‌به‌خط توضیح بده:

از آنجا که محدودهٔ این درس تنها یک صفحه (۹۶) است، کدهای زیر بر اساس مفهوم تعریف ثابت‌ها و مثال‌های رایج در این زمینه بازسازی شده‌اند.

#### مثال ۱: تعریف یک ثابت ساده (Listing 3.12 - بازسازی شده)

این کد یک ثابت برای تعداد دقیقه در ساعت تعریف می‌کند.

```javascript
const MINUTES_IN_HOUR = 60; 
console.log(MINUTES_IN_HOUR); // خروجی: 60

// تلاش برای استفاده بعدی بدون const 
// MINUTES_IN_HOUR = 70; // خطا می‌دهد
```

**توضیح خط به خط:**

* `const`: کلمه کلیدی برای اعلام یک ثابت استفاده می‌شود.

* `MINUTES_IN_HOUR`: نام ثابت است که طبق قرارداد با حروف بزرگ نوشته شده است.

* `= 60;`: مقدار ۶۰ را بلافاصله به این ثابت تخصیص می‌دهد.


#### مثال ۲: اعلان و مقداردهی چندگانه (Listing 3.13 - بازسازی شده)

مانند `let`، می‌توانید چندین ثابت را در یک خط با کاما تعریف کنید، اما این کار به دلیل خوانایی ضعیف توصیه نمی‌شود.

```javascript
const MAX = 4711, MIN = 0; 
console.log(MAX); // خروجی: 4711
console.log(MIN); // خروجی: 0
```

**توضیح خط به خط:**

* `const MAX = 4711, MIN = 0;`: دو ثابت `MAX` و `MIN` در یک دستور تعریف و مقداردهی شدند.

---

### 📊 نمودارها و جداول را به‌صورت Markdown بازسازی کن:

#### جدول ۱: مقایسه `const` و `let`

|                ویژگی               |      `const` (ثابت)     |          `let` (متغیر)          |       مرجع      |
| :--------------------------------: | :---------------------: | :-----------------------------: | :-------------: |
| **قابلیت بازنویسی (Reassignment)** |   خیر (مقدار ثابت است)  |       بله (قابل تغییر است)      |                 |
|     **نیاز به مقداردهی اولیه**     |   بله (اجباری و فوری)   |          خیر (اختیاری)          |                 |
|          **حوزه (Scope)**          |   بلوکی (Block-scoped)  |       بلوکی (Block-scoped)      | (اطلاعات زمینه) |
|          **توصیه استفاده**         | پیش‌فرض (Best Practice) | فقط در صورت نیاز به تغییر مقدار |                 |

#### جدول ۲: قوانین ثبات (Mutability) در `const`

|           نوع داده          |          مثال         | آیا مقدار قابل تغییر است؟ |                              دلیل                             |
| :-------------------------: | :-------------------: | :-----------------------: | :-----------------------------------------------------------: |
| **مقدار اولیه (عدد، رشته)** |     `const x = 5;`    |  خیر (Reassignment ممنوع) |                    مقدار و ارجاع ثابت است.                    |
|        **شیء/آرایه**        |   `const obj = {};`   |   بله (ویژگی‌های داخلی)   | فقط ارجاع (آدرس حافظه) ثابت است؛ محتوای شیء قابل دستکاری است. |
|      **بازنویسی ارجاع**     | `const x = 5; x = 6;` |            خیر            |              این کار منجر به `TypeError` می‌شود.              |

#### جدول ۳: اشتباهات رایج در تعریف ثابت‌ها

|      مشکل (Fehler)      |           مثال کد           |           نوع خطا/نتیجه           |
| :---------------------: | :-------------------------: | :-------------------------------: |
|    عدم مقداردهی اولیه   |         `const ID;`         |           `SyntaxError`           |
|   بازنویسی مقدار اولیه  |    `const R = 5; R = 6;`    |            `TypeError`            |
|     تغییر ارجاع شیء     |  `const O = {}; O = {a:1};` |            `TypeError`            |
| تغییر محتوای شیء (مجاز) | `const O = {a:1}; O.a = 2;` | مجاز، مقدار O.a به ۲ تغییر می‌کند |

#### جدول ۴: قراردادهای نام‌گذاری (Convention)

|              حالت استفاده             |    قرارداد نام‌گذاری    |                  مثال                 |
| :-----------------------------------: | :---------------------: | :-----------------------------------: |
| **ثابت‌های جهانی (Global Constants)** | حروف بزرگ و زیرخط (`_`) |      `MAX_COUNT`, `DEFAULT_COLOR`     |
|  **ثابت‌های محلی (Local Constants)**  | CamelCase (مانند `let`) |      `userLimit` (اگر محلی باشد)      |
|        **بهترین روش توصیه شده**       | `const` برای هر دو حالت | **استفاده از `const` به طور پیش‌فرض** |

---

### 💬 نکات طلایی استاد و اشتباهات رایج:

1. **قانون `const` پیش‌فرض:** همان‌طور که در توصیه‌های بهترین شیوه‌ها (Best Practice) ذکر شد، **همیشه** ابتدا سعی کنید متغیرهای خود را با `const` تعریف کنید. اگر در آینده واقعاً نیاز به بازنویسی (تغییر کامل مقدار) داشتید، آنگاه آن را به `let` تغییر دهید. این کار تعداد خطاهای ناخواسته در کد شما را به شدت کاهش می‌دهد.

2. **ثابت‌ها واقعاً ثابت نیستند!** این یک دام بزرگ برای تازه‌کارهاست. یادت باشد، `const` جلوی تغییر *محتوای* یک شیء یا آرایه را نمی‌گیرد، فقط جلوی تغییر *برچسب/ارجاع* را می‌گیرد (نمونه کد ۴). اگر واقعاً می‌خواهی محتوای یک شیء هم ثابت بماند، باید از متدهای دیگری مثل `Object.freeze()` استفاده کنی.

3. **انتخاب نام:** اگرچه در جاوااسکریپت نام‌گذاری با حروف بزرگ و زیرخط فقط یک قرارداد است، اما آن را برای ثابت‌های مهم و سراسری (مثل `PI` یا `MAX_SIZE`) حفظ کن. این کار خوانایی را برای سایر برنامه‌نویسان بالا می‌برد.

---

### 🧪 تمرین درس:

**تمرین ۱: اعلان و مقداردهی**

یک ثابت به نام `COMPANY_NAME` تعریف کنید و مقدار آن را 'Rheinwerk' قرار دهید.

**تمرین ۲: خطای اجباری**

تلاش کنید یک ثابت به نام `APP_VERSION` تعریف کنید اما به آن مقدار اولیه ندهید. توضیح دهید چه نوع خطایی دریافت می‌کنید؟

**تمرین ۳: خطای بازنویسی**

ثابت `SECONDS_IN_MINUTE` را با مقدار ۶۰ تعریف کنید. سپس در خط بعدی تلاش کنید آن را به ۷۰ تغییر دهید. نتیجه چه خواهد بود؟

**تمرین ۴: ثبات ارجاعی**

یک ثابت آرایه به نام `COLORS` تعریف کنید و سه رنگ در آن قرار دهید. سپس:
الف) مقدار `COLORS` را تغییر دهید.
ب) تلاش کنید کل آرایه `COLORS` را با یک آرایه جدید جایگزین کنید. (نتیجه الف و ب را شرح دهید).

**تمرین ۵: اصلاح کد خطا**

کد زیر یک خطا دارد. آن را طوری اصلاح کنید که کار کند:

```javascript
const URL_ENDPOINT;
URL_ENDPOINT = 'api/data';
```

**تمرین ۶: انتخاب درست**

برای ذخیرهٔ مقدار نهایی مالیات بر ارزش افزوده (VAT) در یک کشور، از `let` استفاده می‌کنید یا `const`؟ چرا؟

**تمرین ۷: پیش‌بینی خروجی**

خروجی کد زیر چیست؟

```javascript
const user = { loggedIn: false };
user.loggedIn = true;
console.log(user.loggedIn);
```

**تمرین ۸: اعلان مجاز**

چرا تعریف دو ثابت `FIRST_NAME` و `SECOND_NAME` در یک خط مجاز است (هرچند توصیه نمی‌شود)؟

---

### 💡 یک پروژه یا مثال کاربردی: تنظیمات محیطی

معمولاً از ثابت‌ها برای نگهداری مقادیر پیکربندی (Configuration) که وابسته به محیط اجرای برنامه هستند، استفاده می‌شود:

فرض کنید در حال ساخت یک برنامه بازی هستید. ما به مقادیری نیاز داریم که نباید در طول اجرای بازی تغییر کنند:

```javascript
'use strict';

// 1. ثابت‌های مربوط به تنظیمات بازی
const GAME_TITLE = "JavaScript Quest";
const MAX_LEVEL = 10;
const STARTING_HEALTH = 100;
const IS_DEBUG_MODE = true; 

// 2. ثابت‌های مربوط به گرافیک و سرور
const API_URLS = {
    SCORE: 'https://api.game.com/score',
    LEADERBOARD: 'https://api.game.com/leaderboard'
};

// --- اجرای بازی ---
if (IS_DEBUG_MODE) {
    console.log(`${GAME_TITLE} در حالت اشکال‌زدایی آغاز شد.`);
}

let playerHealth = STARTING_HEALTH; 
// اینجا playerHealth با let تعریف شده چون باید کم یا زیاد شود.

console.log(`امتیاز بازیکن به: ${playerHealth} تنظیم شد.`);
// تلاش برای تغییر یک ثابت مهم:
// MAX_LEVEL = 11; // اگر این خط را فعال کنید، برنامه متوقف می‌شود!

// استفاده از ثابت شیء:
console.log(`URL امتیازدهی: ${API_URLS.SCORE}`);
```

**توضیح:** در این مثال، `const` تضمین می‌کند که پارامترهای اصلی بازی مانند `MAX_LEVEL` یا آدرس‌های سرور در طول اجرای برنامه (حتی در تابعی که ۱۰۰۰ خط پایین‌تر است) به طور تصادفی تغییر نکنند.

---

### 🧾 خلاصه (Cheat Sheet): جدول نکات کلیدی.

|       کلمه کلیدی      |            هدف           |                  سینتکس                 |                              ویژگی مهم                              |
| :-------------------: | :----------------------: | :-------------------------------------: | :-----------------------------------------------------------------: |
|      **`const`**      | تعریف مقادیر تغییرناپذیر |          `const NAME = value;`          |                 **باید** در لحظه تعریف، مقداردهی شود                |
|    **تغییرناپذیری**   |    جلوگیری از بازنویسی   |          `const x = 5; x = 6;`          |                  ممنوع. منجر به `TypeError` می‌شود.                 |
| **ارجاع (Reference)** |      حفظ آدرس حافظه      |         `const arr =; arr = 2;`         |                مجاز. محتوای آرایه/شیء قابل تغییر است.               |
|   **Best Practice**   |   اطمینان از پایداری کد  | استفاده به جای `let`، مگر در موارد خاص. | تمام داده‌هایی که قرار نیست بازنویسی شوند، از `const` استفاده کنند. |

---

### 📚 آزمون پایانی:

#### سؤالات:

1. کلمه کلیدی `const` برای تعریف چه نوع مقادیری استفاده می‌شود؟

   الف) متغیرهای قابل تغییر

   ب) مقادیر اولیه (Primitive)

   ج) مقادیری که ارجاع آن‌ها ثابت است

   د) مقادیری که در طول برنامه ثابت می‌مانند

2. کدام مورد زیر در مورد `const` **الزامی** است؟

   الف) باید با حروف بزرگ نوشته شود.

   ب) باید با `var` اعلام شود.

   ج) باید بلافاصله مقداردهی اولیه شود.

   د) باید یک عدد باشد.

3. اگر سعی کنیم یک ثابت (مثلاً `const X = 10;`) را بازنویسی کنیم (`X = 20;`)، چه نوع خطایی رخ می‌دهد؟

   الف) `SyntaxError`

   ب) `ReferenceError`

   ج) `TypeError`

   د) هیچ خطایی رخ نمی‌دهد.

4. آیا کد زیر معتبر است؟


   ```javascript
   const USER_CONFIG = { name: 'Guest' };
   USER_CONFIG.name = 'Admin';
   ```

   الف) خیر، به دلیل بازنویسی شیء خطا می‌دهد.

   ب) بله، زیرا محتوای شیء قابل تغییر است.

5. کدام کلمه کلیدی برای متغیرهایی که مقدار آن‌ها در حلقه‌ها شمارش (Increment) می‌شود، مناسب‌تر است؟

   الف) `const`

   ب) `let`

   ج) `var`

   د) `static`

6. اگر یک توسعه‌دهنده از قانون "Best Practice" تبعیت کند، ابتدا سعی می‌کند متغیرهایش را با چه کلمه کلیدی تعریف کند؟

7. چرا تلاش برای تعریف `const PI;` بدون مقداردهی اولیه منجر به `SyntaxError` می‌شود؟

8. آیا می‌توانیم یک متغیر `let` را به یک ثابت `const` تغییر دهیم؟

9. اگر یک آرایه با `const` تعریف شده باشد، آیا می‌توانیم یک عنصر جدید به انتهای آن اضافه کنیم (مثلاً با `push`)؟

10. تفاوت بین `let count = 0;` و `const count = 0;` در چیست، اگر بدانیم قرار است در ادامه برنامه مقدار `count` تغییر کند؟

#### پاسخنامه تشریحی:

1. **ج) مقادیری که ارجاع آن‌ها ثابت است** و **د) مقادیری که در طول برنامه ثابت می‌مانند**: از نظر فنی، `const` تضمین می‌کند که ارجاع (آدرس حافظه) ثابت است. در عمل، برای مقادیر اولیه (اعداد، رشته‌ها) به معنی ثابت ماندن مقدار است.

2. **ج) باید بلافاصله مقداردهی اولیه شود**: این یک الزام سینتکسی برای `const` است.

3. **ج) `TypeError`**: این خطا به صراحت اعلام می‌کند که تلاش برای انتساب به یک متغیر ثابت مجاز نیست.

4. **ب) بله، زیرا محتوای شیء قابل تغییر است**: ارجاع `USER_CONFIG` تغییر نکرده، فقط یک ویژگی داخلی آن تغییر یافته است.

5. **ب) `let`**: زیرا مقدار این متغیر در هر تکرار حلقه تغییر می‌کند و `const` اجازه بازنویسی مکرر را نمی‌دهد.

6. **`const`**: این به عنوان بهترین شیوه توصیه می‌شود، زیرا از بازنویسی ناخواسته جلوگیری می‌کند.

7. زیرا `const` باید تضمین کند که ثابت بودن آن از همان ابتدا رعایت شده است. جاوااسکریپت اجازه نمی‌دهد متغیری که قرار است ثابت باشد، بدون مقدار اولیه تعریف شود (خطای سینتکسی).

8. بله، در هر زمانی می‌توان اعلان قبلی `let` را حذف کرد و متغیر را با `const` تعریف کرد، مشروط بر اینکه بلافاصله مقداردهی شود.

9. بله. اضافه کردن، حذف کردن یا تغییر دادن عناصر یک آرایه (یا ویژگی‌های یک شیء) بر ارجاع اصلی متغیر تأثیر نمی‌گذارد و مجاز است.

10. اگر قرار باشد `count` تغییر کند، استفاده از `const` خطا خواهد داد. `let` برای مقادیر قابل تغییر و `const` برای مقادیر ثابت استفاده می‌شود.

---
